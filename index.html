<!DOCTYPE HTML>

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Heatwave</title>
    <link href="css/heatweb.css" rel="stylesheet" />
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
      <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>

      <style type="text/css">
        div.cartodb-zoom { float: right; margin-right: 20px; }
        div.cartodb-timeslider { right: 20px !important; left: auto !important; }


      </style>
  </head>

  <body>
    <nav class="navigation">
      <h1 class="brand"><a href="#">HeatWave</a></h1>
      <ul class="nav">
        <li class="h-pr tooltip-inner" id="position">
          <div class="tooltip h-pa">
            <p>Do you want choose any city?</p>
          </div>
          <div class="btn">
            <a href="#" class="btn-large location">Position</a>
          </div>
        </li>
        <li class="h-pr tooltip-inner" id="faq">
          <div class="tooltip h-pa">
            <p>Do you want know the most importants advices?</p>
          </div>
          <div class="btn">
            <a href="#" class="btn-large faq" >FAQs</a>
          </div>
        </li>
      </ul>
    </nav>

    <div id="cartodb-map" class="map h-pa"></div>

    <div class="light light-search h-pa animated" id="light-search">
      <p class="h-pa btn btn-close" id="close-light-search"><a href="#" class="close" id="close-lgt-search">cerrar</a></p>
      <h2 class="lgt-title h-tcenter">Choose a city</h2>
      <form class="frm-search" id="form-search">
        <input id="form-txt" type="text" value="City" list="cities-datalist" class="frm-search-txt h-iblock" />
        <datalist id="cities-datalist"></datalist>
        <button class="btn" id="btn-action">
          <span class="btn-large search">hola</span>
        </button>
      </form>
    </div>

    <div class="inner-faqs animated" id="inn-faq">
        <ul>
          <li>
            <h2>Stay hydrated</h2>
            <p>Drink two to three litres of water per day, even if you don't feel thirsty!!! Avoid 'fizzy', alcoholic and caffeinated drinks and do not take salt tablets (unless instructed to by a doctor).</p>
          </li>
          <li>
            <h2>Wear light clothing</h2>
            <p>Dress Summer clothes. Light coloured clothing reflects heat and sunlight and helps your body maintain a normal temperature.</p>
          </li>
          <li>
            <h2>Check on those at risk</h2>
            <p>Visit at risk individuals such as the sick and elderly, at least twice a day and keep an eye on children. Watch for signs of heat-related illness.</p>
          </li>
          <li>
            <h2>Minimise sun exposure</h2>
            <p>Keep out of the sun as much as possible. If you must be in the sun, wear hat and sunglasses. Also make sure you wear sunscreen to prevent sunburn, which limits the body's ability to cope with heat.</p>
          </li>
          <li>
            <h2>Prepare your home</h2>
            <p>Prepare your home early. Service or replace your air conditioner before you need it. Curtains, awnings and blinds can also help to keep the home cool.</p>
          </li>
          <li>
            <h2>Make use of air conditioning</h2>
            <p>If you don't have air conditioning, make use of public facilities such as shopping centres, art galleries, cinemas or other air conditioned buildings. Portable fans are also useful in drawing in cool air, or exhausting warm air from a room.</p>
          </li>
          <li>
            <h2>Remember your pets</h2>
            <p>Pets can be particularly vulnerable to the heat. Make sure they have shade and plenty of cool water to last the day.</p>
          </li>
          <li>
            <h2>Seek medical advice if necessary</h2>
            <p>If you or your know people don't feel good, don't hesitate to contact your local health services.</p>
          </li>  
        </ul>       

    </div>


    <div class="inner-info animated h-tcenter" id="inn-info">
      <p class="h-pa btn btn-close" id="close-info-search" style="right: 20px;"><a href="#" class="close" id="close-lgt-info">cerrar</a></p>
      <h1 class="h-tcenter"><span id="city-name">Madrid</span> <small>(Population: <span id="city-population">1.000.000.000</span>)</small></h1>
      <ul class="inb-list h-iblock h-malign lst-temperatures">
        <li class="h-valign tooltip-inner h-pr" id="value01">
          <p class="h-iblock">
            32º
          </p>
          <div class="tooltip h-pa">
            <p>Do you want choose any city?</p>
          </div>
        </li>
        <li class="h-valign tooltip-inner h-pr" id="value02">
          <p class="h-iblock">
            32º
          </p>
          <div class="tooltip h-pa">
            <p>Do you want choose any city?</p>
          </div>
        </li>
        <li class="h-valign tooltip-inner h-pr" id="value03">
          <p class="h-iblock">
            32º
          </p>
          <div class="tooltip h-pa">
            <p>Do you want choose any city?</p>
          </div>
        </li>
        <li class="h-valign tooltip-inner h-pr" id="value04">
          <p class="h-iblock">
            32º
          </p>
          <div class="tooltip h-pa">
            <p>Do you want choose any city?</p>
          </div>
        </li>
        <li class="h-valign tooltip-inner h-pr" id="value05">
          <p class="h-iblock">
            32º
          </p>
          <div class="tooltip h-pa">
            <p>Do you want choose any city?</p>
          </div>
        </li>
        <li class="h-valign tooltip-inner h-pr" id="value06">
          <p class="h-iblock">
            32º
          </p>
          <div class="tooltip h-pa">
            <p>Do you want choose any city?</p>
          </div>
        </li>
        <li class="h-valign tooltip-inner h-pr" id="value07">
          <p class="h-iblock">
            32º
          </p>
          <div class="tooltip h-pa">
            <p>Do you want choose any city?</p>
          </div>
        </li>
      </ul>

    </div>

    <script src="js/datalist.js"></script>
    <script src="js/temperatures.js"></script>
    <script>  
      var form = document.getElementById("form-search");
      var map;
      var $btnAction = document.querySelector('#btn-action');
      var $cityInput = document.querySelector('#form-txt');

      function addClass(node, classAdd){
          node.className += ' ' + classAdd;
        } 

        function removeClass(node, classRemove){
          node.className = node.className.replace(classRemove,"");
        }

        function hasClass(node, klass){
          var classList = node.className;
          if(classList.indexOf(klass)===-1){
            return false;
          } else {
            return true;
          }
        }


      form.addEventListener("focus", function( event ) {
        document.querySelector("#btn-action").style.opacity="1";    
        document.querySelector("#form-txt").value="";    
      }, true);
      form.addEventListener("blur", function( event ) {
        document.querySelector("#btn-action").style.opacity=".2";
        document.querySelector("#form-txt").value="City";    
      }, true);

      document.querySelector('#position').addEventListener("click", function( event ) {
          if ( !hasClass(document.querySelector('#light-search'), 'bounceInDown') ) { 
           addClass (document.querySelector('#light-search'), 'bounceInDown'); 
          } else {
            removeClass (document.querySelector('#light-search'), 'bounceInDown');
          }

          if ( !hasClass(document.querySelector('#position'), 'active') ) { 
           addClass (document.querySelector('#position'), 'active'); 
          } else {
            removeClass (document.querySelector('#position'), 'active');
          }

          if ( hasClass(document.querySelector('#faq'), 'active') ) { 
           removeClass (document.querySelector('#faq'), 'active'); 
          } 

          if ( hasClass(document.querySelector('#inn-faq'), 'bounceInRight') ) { 
           removeClass (document.querySelector('#inn-faq'), 'bounceInRight');
          }

          setTimeout(function(){$cityInput.focus();}, 1250);
		  }, true);
		

      document.querySelector('#close-light-search').addEventListener("click", function( event ) {
        removeClass(document.querySelector('#light-search'), 'bounceInDown');
      }, true);

      document.querySelector('#close-lgt-info').addEventListener("click", function(event) {
        event.preventDefault();
        removeClass(document.querySelector('#inn-info'), 'bounceInUp');
        // TODO: Reset map
      });

      document.querySelector('#faq').addEventListener("click", function( event ) {
          if ( !hasClass(document.querySelector('#inn-faq'), 'bounceInRight') ) { 
           addClass (document.querySelector('#inn-faq'), 'bounceInRight');
          } else {
           removeClass (document.querySelector('#inn-faq'), 'bounceInRight');
          }

          if ( !hasClass(document.querySelector('#faq'), 'active') ) { 
           addClass (document.querySelector('#faq'), 'active'); 
          } else {
            removeClass (document.querySelector('#faq'), 'active');
          }


          if ( hasClass(document.querySelector('#position'), 'active') ) { 
           removeClass (document.querySelector('#position'), 'active'); 
          } 

          if ( hasClass(document.querySelector('#light-search'), 'bounceInDown') ) { 
           removeClass (document.querySelector('#light-search'), 'bounceInDown');
          }

      }, true);

      function CitySelected(id) {
           removeClass (document.querySelector('#light-search'), 'bounceInDown');

           var city = cities[id]['internalname'];
           window.viz.map.setCenter({lat: cities[id]['lat'], lon: cities[id]['lon']});
           getTemperature(city, id);
      };

      function SetTemperatureData(temperatures, id) {
        document.querySelector('#city-name').innerHTML = cities[id]['internalname'];
        document.querySelector('#city-population').innerHTML = cities[id]['population'];

        document.querySelector("#value01").children[0].innerHTML = temperatures[0];
        document.querySelector("#value02").children[0].innerHTML = temperatures[1];
        document.querySelector("#value03").children[0].innerHTML = temperatures[2];
        document.querySelector("#value04").children[0].innerHTML = temperatures[3];
        document.querySelector("#value05").children[0].innerHTML = temperatures[4];
        document.querySelector("#value06").children[0].innerHTML = temperatures[5];
        document.querySelector("#value07").children[0].innerHTML = temperatures[6];

           addClass (document.querySelector('#inn-info'), 'bounceInUp');
      }

      $btnAction.addEventListener("click", function(event) {
        event.preventDefault();
        // TODO: Remove form and this can work, else triggers two calls
        //CitySelected($cityInput.value);
      });

      $cityInput.addEventListener("keyup", function(event) {
          if (event.keyCode == 13) {
              event.preventDefault();
              if (this.value.length != 0) {
                  CitySelected($cityInput.value);
              }
          }
      });


      function initMap() {
        var layerUrl = 'http://jorgepazj.cartodb.com/api/v2/viz/683601fa-d843-11e3-b620-0e73339ffa50/viz.json';

        window.viz =  cartodb.createVis('cartodb-map', layerUrl);

      }

      document.addEventListener('DOMContentLoaded', function () {
        initMap();
      });
    </script>

  </body>

</html>
