<!DOCTYPE HTML>

<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Heatwave</title>
		<link href="css/heatweb.css" rel="stylesheet" />
		<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
  		<script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>
	</head>

	<body>
    <nav class="navigation">
      <h1 class="brand"><a href="#">HeatWave</a></h1>
      <ul class="nav">
        <li class="h-pr tooltip-inner">
          <div class="tooltip h-pa">
            <p>Do you want choose any city?</p>
          </div>
          <div class="btn">
            <a href="#" class="btn-large location" id="position">Position</a>
          </div>
        </li>
        <li class="h-pr tooltip-inner">
          <div class="tooltip h-pa">
            <p>Do you want know the most importants advices?</p>
          </div>
          <div class="btn">
            <a href="#" class="btn-large faq" id="faq">FAQs</a>
          </div>
        </li>
      </ul>
    </nav>

    <div id="cartodb-map" class="map h-pa"></div>

    <div class="light light-search h-pa animated" id="light-search">
      <p class="h-pa btn btn-close" id="close-light-search"><a href="#" class="close" id="close-lgt-search">cerrar</a></p>
      <h2 class="lgt-title h-tcenter">Choose a city</h2>
      <form class="frm-search" id="form-search">
        <input id="form-txt" type="text" value="City" list="cities-datalist" class="frm-search-txt h-iblock" />
        <datalist id="cities-datalist"></datalist>
        <button class="btn" id="btn-action">
          <span class="btn-large search">hola</span>
        </button>
      </form>
    </div>

    <div class="inner-faqs animated" id="inn-faq">
      hola
    </div>


    <div class="inner-info animated" id="inn-info">

    </div>

    <script>  
		  var form = document.getElementById("form-search");
		  var map;
      var $btnAction = document.querySelector('#btn-action');
      var $cityInput = document.querySelector('#form-txt');

		 	function addClass(node, classAdd){
		      node.className += ' ' + classAdd;
		    } 

		    function removeClass(node, classRemove){
		      node.className = node.className.replace(classRemove,"");
		    }

        function hasClass(node, klass){
          var classList = node.className;
          if(classList.indexOf(klass)===-1){
            return false;
          } else {
            return true;
          }
        }


		  form.addEventListener("focus", function( event ) {
		    document.querySelector("#btn-action").style.opacity="1";    
		    document.querySelector("#form-txt").value="";    
		  }, true);
		  form.addEventListener("blur", function( event ) {
		    document.querySelector("#btn-action").style.opacity=".2";
		    document.querySelector("#form-txt").value="City";    
		  }, true);

		  document.querySelector('#position').addEventListener("click", function( event ) {
          if ( !hasClass(document.querySelector('#light-search'), 'bounceInDown') ) { 
           addClass (document.querySelector('#light-search'), 'bounceInDown');
          }
          if ( hasClass(document.querySelector('#inn-faq'), 'bounceInRight') ) { 
           removeClass (document.querySelector('#inn-faq'), 'bounceInRight');
          }

		  }, true);
		
      document.querySelector('#close-light-search').addEventListener("click", function( event ) {
        removeClass(document.querySelector('#light-search'), 'bounceInDown');
      }, true);

      document.querySelector('#faq').addEventListener("click", function( event ) {
          if ( !hasClass(document.querySelector('#inn-faq'), 'bounceInRight') ) { 
           addClass (document.querySelector('#inn-faq'), 'bounceInRight');
          }

          if ( hasClass(document.querySelector('#light-search'), 'bounceInDown') ) { 
           removeClass (document.querySelector('#light-search'), 'bounceInDown');
          }
      }, true);

      function CitySelected(id) {
           removeClass (document.querySelector('#light-search'), 'bounceInDown');
           addClass (document.querySelector('#inn-info'), 'bounceInUp');

           var item =  dataList.querySelectorAll("option[value=" + id + "]")[0].id;
           console.log(id);
           // TODO: Hook here the data of the city
      };

      $btnAction.addEventListener("click", function( event ) {
        CitySelected($cityInput.value);
      }, true);

      $cityInput.addEventListener("keyup", function (event) {
          if (event.keyCode == 13) {
              event.preventDefault();
              if (this.value.length != 0) {
                  CitySelected($cityInput.value);
              }
          }
      }, false);


	    function initMap() {
	    	var layerUrl = 'http://jorgepazj.cartodb.com/api/v2/viz/683601fa-d843-11e3-b620-0e73339ffa50/viz.json';

      window.viz =  cartodb.createVis('cartodb-map', layerUrl);

	    }

	    document.addEventListener('DOMContentLoaded', function () {
	    	initMap();
	    });
    </script>
    <script src="js/datalist.js"></script>

  </body>

</html>
